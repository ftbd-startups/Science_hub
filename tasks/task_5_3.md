# Задача 5.3: DevOps: Настройка CI/CD

## Информация о задаче
- **ID:** 5.3
- **Статус:** Ожидание
- **Зависимости:** 1.2
- **Приоритет:** Высокий
- **Ответственный:** AI-DevOps-Agent
- **Фаза:** 5 - Отзывы и Завершение

## Описание
Создать автоматизированный CI/CD пайплайн для непрерывной интеграции и развертывания приложения с использованием GitHub Actions.

### Структура пайплайна:
1. **Триггер:** push в ветку `main`
2. **Шаг 1:** Checkout кода
3. **Шаг 2:** Установка зависимостей (Node.js, Supabase CLI)
4. **Шаг 3:** Линтинг и тесты (если есть)
5. **Шаг 4:** Развертывание миграций БД (`supabase db push`)
6. **Шаг 5:** Развертывание Edge Functions (`supabase functions deploy`)
7. **Шаг 6:** Сборка Docker-образа для фронтенда (`docker build`)
8. **Шаг 7:** Push Docker-образа в реестр (GitHub Container Registry)
9. **Шаг 8:** Триггер для развертывания нового образа на хостинге

## Критерии приемки
- Push в `main` автоматически запускает пайплайн
- Пайплайн успешно завершается без ошибок
- Изменения в коде (миграции, функции, фронтенд) отражаются на production-среде
- Rollback механизм в случае неудачного развертывания
- Уведомления о статусе развертывания

## Технические детали
- Использовать `actions/checkout@v3` для получения кода
- `supabase/cli@v1` для работы с Supabase
- Docker для контейнеризации фронтенда
- GitHub Container Registry для хранения образов
- Хранение секретов в GitHub Secrets

### Переменные окружения и секреты:
- `SUPABASE_ACCESS_TOKEN` - токен доступа к Supabase
- `SUPABASE_PROJECT_ID` - ID проекта Supabase
- `DOCKER_REGISTRY_TOKEN` - токен для GitHub Container Registry
- `DEPLOY_WEBHOOK_URL` - webhook для триггера развертывания (опционально)

## Workflow файл
Создать `.github/workflows/deploy.yml` с полной конфигурацией пайплайна

### Основные jobs:
1. **test** - линтинг и тестирование
2. **deploy-backend** - развертывание Supabase компонентов
3. **build-and-deploy-frontend** - сборка и развертывание фронтенда

## Безопасность
- Никогда не логировать секреты
- Использовать принцип минимальных прав доступа
- Валидация environment перед развертыванием
- Проверка branch protection rules

## Мониторинг и логирование
- Детальные логи каждого шага
- Slack/Discord уведомления о статусе (опционально)
- Метрики времени выполнения пайплайна

## Связанные файлы
- `.github/workflows/deploy.yml` - основной workflow
- `Dockerfile` - конфигурация Docker образа
- `docker-compose.prod.yml` - production конфигурация
- `scripts/deploy.sh` - скрипты развертывания (если нужны)

## Входные данные
- Push события в ветку main
- Конфигурация в GitHub Secrets
- Код приложения и инфраструктурные файлы

## Выходные данные
Автоматизированный процесс развертывания с полным контролем качества 
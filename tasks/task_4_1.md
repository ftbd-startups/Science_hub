# Задача 4.1: Backend: CRUD API для Заявок

## Информация о задаче
- **ID:** 4.1
- **Статус:** Ожидание
- **Зависимости:** 3.1
- **Приоритет:** Высокий
- **Ответственный:** AI-Backend-Agent
- **Фаза:** 4 - Заявки и Коммуникация

## Описание
Создать Edge Function `applications` для управления заявками на проекты с автоматическим созданием чатов.

### API Маршруты:
- `POST /`: Создание новой заявки (только для `researcher`)
  - Принимает `project_id` и `cover_letter`
  - **Критически важно:** после успешного создания заявки в той же транзакции создать запись в таблице `chats`
- `GET /my`: Получение списка заявок, поданных аутентифицированным `researcher`
- `GET /project/:projectId`: Получение списка заявок на конкретный проект (только для владельца проекта)
- `PATCH /:id`: Обновление статуса заявки (`viewed`, `rejected`, `accepted`) - только для владельца проекта

## Критерии приемки
- Ученый может подать заявку на проект
- Компания может просматривать заявки на свои проекты и менять их статус
- Ученый может видеть статус своих заявок
- При создании заявки автоматически создается чат
- Все операции защищены RLS-политиками
- Нельзя подать повторную заявку на тот же проект

## Технические детали
- Создать RLS-политики для таблицы `applications`
- Использовать RPC-функцию в PostgreSQL для транзакционного создания заявки и чата
- Валидация данных с помощью Zod
- Проверка существования проекта и валидности статуса

## SQL компоненты
- RPC функция `create_application_with_chat(project_id, cover_letter)`
- RLS политики для applications таблицы
- Триггеры для обновления статусов

## Связанные файлы
- `supabase/functions/applications/index.ts`
- `supabase/migrations/` - RLS политики и RPC функции
- Модели данных: applications, chats

## Входные данные
- `POST /`: project_id (uuid), cover_letter (text)
- `PATCH /:id`: status (enum)

## Выходные данные
JSON-ответы с данными заявки(ок) или статусом операции 
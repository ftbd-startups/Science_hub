# Задача 2.2: Backend: Создание профилей после регистрации

## Информация о задаче
- **ID:** 2.2
- **Статус:** Ожидание
- **Зависимости:** 1.3
- **Приоритет:** Высокий
- **Ответственный:** AI-Backend-Agent
- **Фаза:** 2 - Аутентификация и Профили

## Описание
Создать триггер в PostgreSQL на таблице `auth.users`. Триггер должен вызывать функцию, которая на основе `raw_user_meta_data.role` (переданного при регистрации) создает запись в `public.users` и соответствующую пустую запись в `public.company_profiles` или `public.researcher_profiles`.

## Критерии приемки
- После регистрации нового пользователя автоматически создаются связанные записи в публичных таблицах профилей

## Технические детали
- Создание PostgreSQL функции для обработки новых пользователей
- Настройка триггера на INSERT в auth.users
- Логика определения роли из raw_user_meta_data
- Создание соответствующих записей в профильных таблицах

## SQL компоненты
- Функция `handle_new_user()`
- Триггер `on_auth_user_created`
- Обработка ошибок и валидация данных

## Связанные файлы
- `supabase/migrations/` - миграция с триггером
- `supabase/functions/` - Edge Functions (если потребуется) 
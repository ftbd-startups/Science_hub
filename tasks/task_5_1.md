# Задача 5.1: Backend: API для Отзывов

## Информация о задаче
- **ID:** 5.1
- **Статус:** Ожидание
- **Зависимости:** 3.1
- **Приоритет:** Средний
- **Ответственный:** AI-Backend-Agent
- **Фаза:** 5 - Отзывы и Завершение

## Описание
Создать Edge Function `reviews` для системы взаимных отзывов между участниками завершенных проектов.

### API Маршруты:
- `POST /`: Создание нового отзыва
  - Проверка что `project.status` равен `'completed'`
  - Проверка что `author_id` является либо владельцем проекта, либо принятым кандидатом
  - Проверка что пользователь еще не оставлял отзыв на этот проект
- `GET /user/:userId`: Получение всех отзывов, оставленных о конкретном пользователе

## Критерии приемки
- Отзыв можно оставить только на завершенный проект
- Отзыв могут оставить только участники проекта (компания и принятый исследователь)
- Нельзя оставить больше одного отзыва на проект от одного автора
- Валидация рейтинга (1-5) и текста отзыва
- RLS политики защищают от несанкционированного доступа

## Технические детали
- Вся логика проверок должна быть реализована внутри Edge Function перед вставкой данных в БД
- Создать функцию `validate_review_permissions()` для проверки прав
- Использовать транзакции для атомарности операций
- Валидация входных данных с помощью Zod

### Проверки безопасности:
1. Проект завершен (`status = 'completed'`)
2. Автор отзыва - участник проекта:
   - Владелец проекта (company_id)
   - Принятый кандидат (researcher_id из accepted application)
3. Уникальность отзыва (author_id + project_id + recipient_id)

## Структура отзыва
```typescript
interface Review {
  id: uuid;
  project_id: uuid;
  author_id: uuid;    // кто оставляет отзыв
  recipient_id: uuid; // о ком отзыв
  rating: number;     // 1-5
  text: string;
  created_at: timestamp;
}
```

## Связанные файлы
- `supabase/functions/reviews/index.ts`
- `supabase/migrations/` - таблица reviews и RLS политики
- Модели данных: reviews, projects, applications

## Входные данные
- `POST /`: project_id, recipient_id, rating (1-5), text
- `GET /user/:userId`: user ID для получения отзывов

## Выходные данные
JSON-ответы с данными отзыва(ов) или статусом операции 